"use strict";(self["webpackChunkvue_toutiao"]=self["webpackChunkvue_toutiao"]||[]).push([[198],{198:function(t,i,s){s.r(i),s.d(i,{default:function(){return Z}});var a=function(){var t=this,i=t._self._c;return i("div",[i("van-nav-bar",{attrs:{fixed:"",title:"文章详情","left-arrow":""},on:{"click-left":function(i){return t.$router.back()}}}),t.article?i("div",{staticClass:"article-container"},[i("h1",{staticClass:"art-title"},[t._v(t._s(t.article.title))]),i("van-cell",{attrs:{center:"",title:t.article.aut_name,label:t._f("dateFormat")(t.article.pubdate)},scopedSlots:t._u([{key:"icon",fn:function(){return[i("img",{staticClass:"avatar",attrs:{src:t.article.aut_photo,alt:""}})]},proxy:!0},{key:"default",fn:function(){return[i("div",[t.article.is_followed?i("van-button",{attrs:{type:"info",size:"mini"},on:{click:t.setUnfollow}},[t._v("已关注")]):i("van-button",{attrs:{icon:"plus",type:"info",size:"mini",plain:""},on:{click:t.setFollow}},[t._v("关注")])],1)]},proxy:!0}],null,!1,96818678)}),i("van-divider"),i("div",{staticClass:"art-content",domProps:{innerHTML:t._s(t.article.content)}}),i("van-divider",[t._v("End")]),i("div",{staticClass:"like-box"},[1===t.article.attitude?i("van-button",{attrs:{icon:"good-job",type:"danger",size:"small"},on:{click:t.setDislike}},[t._v("已点赞 ")]):i("van-button",{attrs:{icon:"good-job-o",type:"danger",plain:"",size:"small"},on:{click:t.setLike}},[t._v("点赞")])],1)],1):t._e(),i("art-cmt",{attrs:{"art-id":t.id}})],1)},e=[],n=s(361);const o=t=>n.Z.get(`/v1_0/articles/${t}`),c=t=>n.Z.post("/v1_0/user/followings",{target:t}),l=t=>n.Z["delete"](`/v1_0/user/followings/${t}`),r=t=>n.Z.post("/v1_0/article/likings",{target:t}),d=t=>n.Z["delete"](`/v1_0/article/likings/${t}`),m=(t,i)=>n.Z.get("/v1_0/comments",{params:{type:"a",source:t,offset:i}}),u=t=>n.Z.post("/v1_0/comment/likings",{target:t}),h=t=>n.Z["delete"](`/v1_0/comment/likings/${t}`),v=(t,i)=>n.Z.post("/v1_0/comments",{target:t,content:i});var f=function(){var t=this,i=t._self._c;return i("div",{class:t.isShowBox1?"art-cmt-container-1":"art-cmt-container-2"},[i("van-list",{staticClass:"cmt-list",attrs:{finished:t.finished,"finished-text":"没有更多评论了","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(i){t.loading=i},expression:"loading"}},t._l(t.cmtlist,(function(s){return i("div",{key:s.com_id.toString(),staticClass:"cmt-item"},[i("div",{staticClass:"cmt-header"},[i("div",{staticClass:"cmt-header-left"},[i("img",{staticClass:"avatar",attrs:{src:s.aut_photo,alt:""}}),i("span",{staticClass:"uname"},[t._v(t._s(s.aut_name))])]),i("div",{staticClass:"cmt-header-right"},[s.is_liking?i("van-icon",{attrs:{name:"like",size:"16",color:"red"},on:{click:function(i){return t.delLike(s)}}}):i("van-icon",{attrs:{name:"like-o",size:"16",color:"gray"},on:{click:function(i){return t.addLike(s)}}})],1)]),i("div",{staticClass:"cmt-body"},[t._v(t._s(s.content))]),i("div",{staticClass:"cmt-footer"},[t._v(t._s(t._f("dateFormat")(s.pubdate)))])])})),0),t.isShowBox1?i("div",{staticClass:"add-cmt-box van-hairline--top"},[i("van-icon",{attrs:{name:"arrow-left",size:"18"},on:{click:function(i){return t.$router.back()}}}),i("div",{staticClass:"ipt-cmt-div",on:{click:t.showBox2}},[t._v("发表评论")]),i("div",{staticClass:"icon-box"},[i("van-badge",{attrs:{content:t.cmtCount,max:99}},[i("van-icon",{attrs:{name:"comment-o",size:"20"},on:{click:t.scrollToCmtList}})],1),i("van-icon",{attrs:{name:"star-o",size:"20"}}),i("van-icon",{attrs:{name:"share-o",size:"20"}})],1)],1):i("div",{staticClass:"cmt-box van-hairline--top"},[i("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.cmt,expression:"cmt",modifiers:{trim:!0}}],ref:"iptCmt",attrs:{placeholder:"友善评论、理性发言、阳光心灵"},domProps:{value:t.cmt},on:{blur:[t.hideBox2,function(i){return t.$forceUpdate()}],input:function(i){i.target.composing||(t.cmt=i.target.value.trim())}}}),i("van-button",{attrs:{type:"default",disabled:0===t.cmt.length},on:{click:t.pubCmt}},[t._v("发布")])],1)],1)},_=[],p=s(94),g={name:"ArtCmt",props:{artId:{type:[String,Number],required:!0}},data(){return{cmtlist:[],offset:null,loading:!1,finished:!1,isShowBox1:!0,cmtCount:0,cmt:""}},created(){this.initCmtList()},methods:{async initCmtList(){const{data:t}=await m(this.artId,this.offset);"OK"===t.message&&(this.cmtCount=t.data.total_count,this.cmtlist=[...this.cmtlist,...t.data.results],this.offset=t.data.last_id,this.loading=!1,0===t.data.results.length&&(this.finished=!0))},onLoad(){this.initCmtList()},async addLike(t){const{data:i}=await u(t.com_id.toString());"OK"===i.message&&(t.is_liking=!0)},async delLike(t){const i=await h(t.com_id.toString());204===i.status&&(t.is_liking=!1)},showBox2(){this.isShowBox1=!1,this.$nextTick((()=>{this.$refs.iptCmt.focus()}))},hideBox2(){setTimeout((()=>{this.isShowBox1=!0,this.cmt=""}),100)},async pubCmt(){const{data:t}=await v(this.artId,this.cmt);"OK"===t.message&&(this.cmtCount+=1,t.data.new_obj.is_liking=!1,this.cmtlist.unshift(t.data.new_obj),this.$toast.success("发表评论成功"))},scrollToCmtList(){const t=window.scrollY,i=document.querySelector(".article-container").offsetHeight;(0,p.animate)({from:t,to:i,onUpdate:t=>window.scrollTo(0,t)})}}},k=g,w=s(1),C=(0,w.Z)(k,f,_,!1,null,"984b3dd8",null),b=C.exports,x=s(253),y=s.n(x),L={name:"ArticleDetail",props:["id"],data(){return{article:null}},created(){this.initArticle()},methods:{async initArticle(){const{data:t}=await o(this.id);"OK"===t.message&&(this.article=t.data)},async setFollow(){const{data:t}=await c(this.article.aut_id.toString());"OK"===t.message&&(this.$toast.success("关注成功！"),this.article.is_followed=!0)},async setUnfollow(){const t=await l(this.article.aut_id.toString());204===t.status&&(this.$toast.success("取关成功！"),this.article.is_followed=!1)},async setLike(){const{data:t}=await r(this.id);"OK"===t.message&&(this.$toast.success("点赞成功！"),this.article.attitude=1)},async setDislike(){const t=await d(this.id);204===t.status&&(this.$toast.success("取消点赞成功！"),this.article.attitude=-1)}},watch:{id(){this.article=null,this.initArticle()}},beforeRouteLeave(t,i,s){i.meta.top=window.scrollY,setTimeout((()=>{s()}),0)},updated(){this.article&&y().highlightAll()},components:{ArtCmt:b}},$=L,S=(0,w.Z)($,a,e,!1,null,"ef683954",null),Z=S.exports}}]);
//# sourceMappingURL=198.34d8a11d.js.map